<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>全球情绪地图</title>

  <!-- 引入 ECharts 主库和世界地图 -->
  <script src="https://cdn.jsdelivr.net/npm/echarts@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/echarts/map/js/world.js"></script>

  <!-- 引入数据文件 -->
  <script src="map_data.js"></script>
  <script src="tooltip_emotions.js"></script>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: #e6f0fa; /* 浅蓝色背景 */
      font-family: sans-serif;
    }

    /* 矩形容器，控制图表大小 */
    #emotionMapContainer {
      width: 90%;
      height: 650px;
      margin: 40px auto;
      border: 2px solid #aaccee;
      border-radius: 8px;
      background: #d9e8ff; /* 更浅的蓝色作为容器背景 */
      box-shadow: 0 6px 20px rgba(70,130,180,0.2);
    }
  </style>
</head>
<body>
  <div id="emotionMapContainer"></div>

  <script>
    const chart = echarts.init(document.getElementById('emotionMapContainer'));

    chart.setOption({
      title: {
        text: '全球情绪地图 - 中美贸易战',
        left: 'center'
      },
      tooltip: {
        trigger: 'item',
        enterable: true,
        backgroundColor: 'rgba(250, 250, 255, 0.95)', // 浅非常浅色背景
        borderColor: '#a3c1ff',
        borderWidth: 1,
        borderRadius: 8,
        textStyle: {
          color: '#333'
        },
        formatter: function(params) {
          const emotions = tooltipEmotions[params.name];
          if (!emotions) return `${params.name}<br/>无情绪数据`;
          const pieId = 'pie-' + params.name.replace(/\s/g, '_');  // 防止国家名含空格导致ID错误

          setTimeout(() => {
            const pieChart = echarts.init(document.getElementById(pieId));
            pieChart.setOption({
              series: [{
                type: 'pie',
                radius: '50%',
                data: emotions,
                label: {
                  formatter: '{b}: {d}%'
                }
              }]
            });
          }, 10);

          return `
            <div><strong>${params.name}</strong></div>
            <div style='width:380px;height:200px;' id='${pieId}'></div>
          `;
        }
      },
      visualMap: {
        min: -2,
        max: 2,
        text: ['积极', '消极'],
        calculable: true,
        inRange: {
          color: ['#d94e5d', '#eac736', '#50a3ba']
        },
        left: 'left',
        bottom: '5%'
      },
      series: [{
        type: 'map',
        map: 'world',
        name: '情绪得分',
        roam: true,
        data: mapData
      }]
    });
  </script>
</body>
</html>
